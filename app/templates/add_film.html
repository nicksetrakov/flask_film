{% extends 'base.html' %}

{% block content %}
<!-- CONTENT -->
<div id="content">
    <div class="ic">More Website Templates at TemplateMonster.com!</div>
    <div class="line-hor"></div>
    <div class="box">
        <div class="border-right">
            <div class="border-left">
                <div class="inner">
                    <h2>Add New Film</h2>
                    <form method="POST" enctype="multipart/form-data">
                        {{ form.hidden_tag() }}
                        <div class="form-group">
                            {{ form.title.label() }}
                            {{ form.title(class="form-control") }}
                            {% for error in form.title.errors %}
                            <div class="alert alert-danger">{{ error }}</div>
                            {% endfor %}
                        </div>
                        <div class="form-group">
                            <label>Выберите жанры:</label>
                            <div>
                                {% for genre_id, genre_name in form.genres.choices %}
                                <label class="checkbox-inline">
                                    <input type="checkbox" name="genres" value="{{ genre_id }}">
                                    {{ genre_name }}
                                </label>
                                {% endfor %}
                            </div>
                        </div>
                        <div id="selected-genres" class="mb-3">
                            Выбранные жанры:
                            <ul id="selected-genres-list"></ul>
                        </div>
                        <button type="button" id="add_genre" class="btn btn-primary">Добавить жанр</button>
                        <div class="mb-3">
                            {{ form.release_year.label() }}
                            {{ form.release_year(class="form-control") }}
                            {% for error in form.release_year.errors %}
                            <div class="alert alert-danger">{{ error }}</div>
                            {% endfor %}
                        </div>
                        <div class="mb-3">
                            {{ form.director.label() }}
                            {{ form.director(class="form-control") }}
                            {% for error in form.director.errors %}
                            <div class="alert alert-danger">{{ error }}</div>
                            {% endfor %}
                        </div>
                        <div class="mb-3">
                            {{ form.description.label() }}
                            {{ form.description(class="form-control") }}
                            {% for error in form.description.errors %}
                            <div class="alert alert-danger">{{ error }}</div>
                            {% endfor %}
                        </div>
                        <div class="mb-3">
                            {{ form.rating.label() }}
                            {{ form.rating(class="form-control") }}
                            {% for error in form.rating.errors %}
                            <div class="alert alert-danger">{{ error }}</div>
                            {% endfor %}
                        </div>
                        <div class="mb-3">
                            {{ form.poster.label() }}
                            {{ form.poster(class="form-control", type="file") }}
                            {% for error in form.poster.errors %}
                            <div class="alert alert-danger">{{ error }}</div>
                            {% endfor %}
                            {% if poster_error %}
                            <div class="alert alert-danger">{{ poster_error }}</div>
                            {% endif %}
                        </div>


                        <button type="submit" class="btn btn-primary">Сохранить</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const checkboxes = document.querySelectorAll('input[type="checkbox"]');
        const selectedGenresList = document.getElementById('selected-genres-list');

        checkboxes.forEach(function (checkbox) {
            checkbox.addEventListener('change', function () {
                const selectedGenreId = checkbox.value;
                const selectedGenreName = checkbox.parentElement.textContent.trim();

                if (checkbox.checked) {
                    const listItem = document.createElement('li');
                    listItem.textContent = selectedGenreName;
                    selectedGenresList.appendChild(listItem);
                } else {
                    // Если флажок снят, удалите соответствующий жанр из списка выбранных
                    const genreItems = selectedGenresList.querySelectorAll('li');
                    genreItems.forEach(function (item) {
                        if (item.textContent === selectedGenreName) {
                            item.remove();
                        }
                    });
                }
            });
        });
    });
</script>
{% endblock %}